<server code as in canvas above>